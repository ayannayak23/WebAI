<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Indoor Safety with COCO-SSD</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/cd1f0829a6.js" crossorigin="anonymous"></script>
</head>
<body>
    <h1>Smart Indoor Safety and Occupancy Monitoring using COCO-SSD in TensorFlow.js</h1>
    <p>Wait for the model to load before clicking the button to enable the webcam. The webcam will become visible once enabled.</p>
    
    <div id="loading">
        <div class="spinner"></div>
        <p>Loading object detection model… Please wait.</p>
    </div>
    
    <section id="demos" class="dimmed">
        <p>This application uses real-time object detection to monitor indoor environments. It focuses on detecting people and common personal objects to support safety, occupancy awareness, and incident capture. Click "Enable Webcam" below and allow camera access when prompted.</p>
        
        <div class="main-container">
            <!-- Left Panel: Controls -->
            <div class="control-panel">
                <div class="control-group">
                    <h3>Camera Controls</h3>
                    <button id="webcamButton" class="btn btn-primary">Enable Webcam</button>
                    <button id="stopWebcam" class="btn btn-secondary" disabled>Stop Webcam</button>
                </div>
                
                <div class="control-group">
                    <h3>Upload Image</h3>
                    <div id="imageUpload">
                        <input type="file" id="imageInput" accept="image/*" class="file-input">
                    </div>
                </div>

                <button id="screenshotBtn" class="btn btn-secondary" disabled><i class="fa-regular fa-camera" style="color: #ffffff;"></i> Take Screenshot</button>
                <button id="toggleROI" class="btn btn-secondary" disabled><i class="fa-solid fa-users-viewfinder" style="color: #ffffff;"></i> Toggle ROI</button>

            </div>
            
            <!-- Middle Panel: Camera/Image View -->
            <div class="view-panel">
                <div id="liveView" class="camView invisible">
                    <video id="webcam" autoplay muted width="640" height="480"></video>
                    <div id="performancePanel">
                        <h3>Performance</h3>
                        <p>FPS: <span id="fpsValue">0</span></p>
                        <p>Inference time: <span id="timeValue">0</span> ms</p>
                    </div>
                </div>
                <canvas id="imageCanvas" class="invisible"></canvas>
            </div>

            <div id="noCamMessage" class="invisible">
                <div class="warning-message">
                    <span class="warning-icon">⚠</span>
                    <div>
                        <p>Webcam access was denied.</p>
                        <p>Please allow camera permissions and reload the page.</p>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Settings -->
            <div class="settings-panel">
                <div class="control-group">
                    <h3>Backend Settings</h3>
                    <select id="backend" class="backend-select">
                        <option value="webgl">WebGL</option>
                        <option value="cpu">CPU</option>
                    </select>
                    <p id="status"></p>
                </div>
                
                <div id="confidenceControl" class="control-group invisible">
                    <h3>Confidence Threshold</h3>
                    <input type="range" id="confidenceSlider" min="0" max="100" value="66">
                    <div class="slider-value">
                        <span id="confidenceValue">66%</span>
                    </div>
                </div>
                
                <div id="classFilters" class="control-group invisible">
                    <h3>Filter Detected Classes</h3>
                    <div id="filterList">
                        <p class="no-filters">No detections yet</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <p id="occupancyWarning" class="warning invisible"></p>


    <!-- Model Info at the bottom -->
    <div id="modelInfo" class="panel invisible">
        <h3>Model Information</h3>
        <ul>
            <li><strong>Name:</strong> COCO-SSD (MobileNet v2)</li>
            <li><strong>Framework:</strong> TensorFlow.js (v4.22.0)</li>
            <li><strong>Model Size:</strong> ~268 KB (unpacked)</li>
            <li><strong>Purpose:</strong> Real-time object detection</li>
        </ul>
    </div>

    <!-- Import TensorFlow.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js" type="text/javascript"></script>
    <!-- Load the coco-ssd model to use to recognize things in images -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    <!-- Load our custom script after libraries are available -->
    <script src="script.js" defer></script>
    <script src="roi.js" defer></script>
    <script src="trackByID.js" defer></script>
    <script src="drawImagePrdictions.js" defer></script>
    <script src="backendOptions.js" defer></script>
    <script src="screenshot.js" defer></script>
</body>
</html>